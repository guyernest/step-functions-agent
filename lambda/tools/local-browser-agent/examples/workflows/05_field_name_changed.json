{
  "name": "Dynamic Field Lookup - Name/ID Changes",
  "description": "Demonstrates handling input fields whose names or IDs change frequently (A/B testing, internationalization, dynamic forms).",
  "starting_page": "https://example.com/checkout",
  "llm_provider": "openai",
  "llm_model": "gpt-4o-mini",
  "abort_on_error": false,
  "steps": [
    {
      "type": "try",
      "name": "Fill Phone Number",
      "description": "Find and fill phone field (name changes across regions/tests)",
      "strategies": [
        {
          "name": "Strategy 1: US English field name",
          "description": "Standard US form field naming",
          "steps": [
            {
              "action": "fill",
              "locator": {"strategy": "selector", "value": "input[name='phone']"},
              "value": "+1-555-0123"
            }
          ],
          "verify": {
            "type": "element_exists",
            "selector": "input[name='phone'][value='+1-555-0123']",
            "timeout": 2000
          }
        },
        {
          "name": "Strategy 2: UK English field name",
          "description": "UK variant naming",
          "steps": [
            {
              "action": "fill",
              "locator": {"strategy": "selector", "value": "input[name='telephone']"},
              "value": "+1-555-0123"
            }
          ],
          "verify": {
            "type": "element_exists",
            "selector": "input[name='telephone'][value='+1-555-0123']",
            "timeout": 2000
          }
        },
        {
          "name": "Strategy 3: Semantic ID",
          "description": "ID-based lookup",
          "steps": [
            {
              "action": "fill",
              "locator": {"strategy": "selector", "value": "#phoneNumber, #phone-number, #contact-phone"},
              "value": "+1-555-0123"
            }
          ],
          "verify": {
            "type": "js_eval",
            "expression": "document.querySelector('#phoneNumber, #phone-number, #contact-phone')?.value === '+1-555-0123'"
          }
        },
        {
          "name": "Strategy 4: Label association",
          "description": "Find input by associated label text",
          "steps": [
            {
              "action": "fill",
              "locator": {"strategy": "selector", "value": "input[aria-label*='phone' i], input[aria-label*='telephone' i]"},
              "value": "+1-555-0123"
            }
          ],
          "verify": {
            "type": "js_eval",
            "expression": "document.querySelector('input[aria-label*=\"phone\" i], input[aria-label*=\"telephone\" i]')?.value === '+1-555-0123'"
          }
        },
        {
          "name": "Strategy 5: Type attribute + position",
          "description": "Find by input type and context",
          "steps": [
            {
              "action": "fill",
              "locator": {"strategy": "selector", "value": "input[type='tel']"},
              "value": "+1-555-0123"
            }
          ],
          "verify": {
            "type": "element_exists",
            "selector": "input[type='tel'][value='+1-555-0123']",
            "timeout": 2000
          }
        },
        {
          "name": "Strategy 6: Vision LLM",
          "description": "AI visual recognition",
          "escalate": {
            "type": "vision_llm",
            "prompt": "Find the phone number input field on this checkout form and enter '+1-555-0123'. The field might be labeled as 'Phone', 'Telephone', 'Contact Number', or similar.",
            "timeout": 20000,
            "max_actions": 3
          }
        }
      ],
      "on_all_strategies_failed": {
        "type": "sequence",
        "steps": [
          {
            "action": "screenshot",
            "description": "Capture form state"
          },
          {
            "action": "execute_js",
            "description": "Debug: List all input fields",
            "script": "return Array.from(document.querySelectorAll('input')).map(el => ({tag: el.tagName, type: el.type, name: el.name, id: el.id, placeholder: el.placeholder, ariaLabel: el.getAttribute('aria-label')}));"
          }
        ],
        "then": {
          "action": "error",
          "message": "Could not locate phone number field"
        }
      }
    },
    {
      "type": "switch",
      "name": "Handle different form variants",
      "description": "Different checkout flows based on form structure",
      "cases": [
        {
          "condition": {
            "type": "element_exists",
            "selector": "#billing-same-as-shipping",
            "timeout": 2000
          },
          "steps": [
            {
              "action": "click",
              "description": "Single address form variant",
              "locator": {"strategy": "selector", "value": "#billing-same-as-shipping"}
            }
          ],
          "then": {
            "goto": "PaymentSection"
          }
        },
        {
          "condition": {
            "type": "element_exists",
            "selector": "#separate-billing-address",
            "timeout": 2000
          },
          "steps": [
            {
              "action": "click",
              "description": "Separate billing form variant",
              "locator": {"strategy": "selector", "value": "#separate-billing-address"}
            },
            {
              "action": "fill",
              "locator": {"strategy": "selector", "value": "#billing-street"},
              "value": "123 Billing St"
            }
          ],
          "then": {
            "goto": "PaymentSection"
          }
        }
      ],
      "default": {
        "steps": [
          {
            "action": "screenshot",
            "description": "Unknown form variant - capture for analysis"
          }
        ],
        "then": {
          "continue": true
        }
      }
    },
    {
      "name": "PaymentSection",
      "action": "screenshot",
      "description": "Payment section - end of workflow"
    }
  ]
}
